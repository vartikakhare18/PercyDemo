<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        .table1,{
  border-collapse: collapse;
}

.tr1:nth-child(even) {
  background-color: bisque;
  }

.td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;

  }

h2{
display: inline-block
}

    </style>
</head>
<body>
<h1 id="heading" style="color: white;font-style: normal;font-family: sans-serif;bordr: 10px;border-bottom: 6px solid black;background-color: #5191D1;;text-align:center">NETSPEND TEST MANAGEMENT TOOL</h1>
<div id="input" style="text-align:center">
    <select id='selType' style='width: 150px;height: 25px' onchange="cleartextbox()">
        <option value='0'>--Select Input Type--</option>
        <option value='1'>PlanId</option>
        <option value='2'>JiraKey</option>
        <option value='3'>TestCollabLink</option>
    </select>
    <input type="url" id="myText" style="height:19px; width:110px">
    <button id="submit" class="search" style="width:90px;height:25px;background-color:#5191D1;color:white" onclick="viewExecutionHistory()">Search</button>
</div>
<br>
<div id="execHistory" >
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript">

function cleartextbox()
{
  document.getElementById("myText").value = "";
}

function viewExecutionHistory()
{
  var input = $("#myText").val();
  var type = $("#selType option:selected").text();
  if(validateData()){
    $.ajax({
        async: false,
        url: '/fetchExecutionHistory',
        type: "post",
        data: input+'splitter'+type,
        success: function (result) {

        if(result.includes("Please enter valid JiraStory")){
            alert(result);}

        else if(result.includes("Please enter JiraKey Story")){
            alert(result);}

        else if(result.includes("No execution plan")){
            alert(result);}

        else if(result.includes("Invalid Execution PlanId")){
            alert(result);}

        else if(result.includes("Invalid TestCollabLink")){
            alert(result);}

        else if(result.includes("Invalid TestCollab Execution Id")){
            alert(result);}

        else if(result.includes("Invalid TestCollab TestPlan Id")){
            alert(result);}

        else if(result.includes("Story Type JiraKey")){
            alert(result);}

        else{
        $("#execHistory").html(result);
            }

        },

        error: function (res) {
        alert("XML: not working! " + res.statusText);
        }
    });
  }
}

function validateData()
{
  var type = document.getElementById('selType');
  var id = document.getElementById('myText')
        var optionSelIndex = type.options[type.selectedIndex].value;

        if (optionSelIndex == 0 && id.value == 0){
           alert("Please select a input type from dropDown\r\nPlease provide input Id in textBox");
           return false;
           }
        else if(id.value == 0){
           alert("Please provide input Id in textBox");
           return false;
           }
        else if(optionSelIndex == 0){
           alert("Please select the input type from dropDown")
           return false;
           }
        else
           return true;
}

function makeDeleteButtonVisible(){
   $('input:checkbox').change(function () {
        if ($('input[type=checkbox]:checked').length > 0) {
            $("#delete").css("visibility","visible");
            $("#selectAll").css("visibility","visible");
        } else {
            $("#delete").css("visibility","hidden");
            $("#selectAll").css("visibility","hidden");
        }
    });
}

function selectAll(){
         var inputs = document.querySelectorAll("input[type='checkbox']");
        for(var i = 0; i < inputs.length; i++) {
            inputs[i].checked = true;
        }
  }


function deleteRow()
{
    var checkedValues;
    var jiraKey = $(".jiraKey").text();
        checkedValues = $('input:checkbox:checked').map(function() {
  				        var row = $(this).parents(".tr1");
                        return row.find('.name').text()+"splitter!!"+row.find('.envName').text()+"splitter!!"+row.find('.featureFilePath').text()+"splitter!!"+row.find('.userName').text();
                        }).get();

        $.ajax({
            async: false,
            url: '/validateSelectedRowData',
            type: 'post',
            contentType: 'application/json; charset=utf-8',
            data: checkedValues.join("^^")+"~~"+jiraKey,
            success: function (result) {
            if(result.includes("User can not delete scenario")){
            alert(result);
            }
            else if(result.includes("User is not authorized to delete the scenario/s executed by another user")){
              alert(result);
            }
            else if(result.includes("An error occurred while deleting the below scenario in Database")){
              alert(result);
            }
            else{
                var confirmation = confirm("Want to delete Selected Scenario/s");
                if (confirmation == true) {
                    $.ajax({
                      async: false,
                      url: '/deleteScenarioFromDB',
                      type: 'post',
                      success: function (result) {
                      $("#submit").click();
                      },
                      error: function (res) {
                         alert("XML: not working! " + res.statusText);
                      }
                    });
                }
            }

            },
            error: function (res) {
              alert("XML: not working! " + res.statusText);
            }
        });
}


</script>

</body>
</html>